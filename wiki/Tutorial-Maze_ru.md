# Руководство: Создание Игры-Лабиринта

> **Select your language / Choisissez votre langue / Wählen Sie Ihre Sprache:**
>
> [English](Tutorial-Maze) | [Français](Tutorial-Maze_fr) | [Deutsch](Tutorial-Maze_de) | [Italiano](Tutorial-Maze_it) | [Español](Tutorial-Maze_es) | [Português](Tutorial-Maze_pt) | [Slovenščina](Tutorial-Maze_sl) | [Українська](Tutorial-Maze_uk) | [Русский](Tutorial-Maze_ru)

---

## Введение

В этом руководстве вы создадите **Игру-Лабиринт**, где игрок перемещается по коридорам к выходу, избегая препятствий и собирая монеты. Этот классический тип игры идеально подходит для изучения плавного движения, обнаружения столкновений и дизайна уровней.

**Что вы узнаете:**
- Плавное движение игрока с вводом с клавиатуры
- Обработка столкновений со стенами
- Обнаружение цели (достижение выхода)
- Собираемые предметы
- Простая система таймера

**Сложность:** Начинающий
**Пресет:** Пресет для Начинающих

---

## Шаг 1: Понять Игру

### Правила Игры
1. Игрок перемещается по лабиринту с помощью клавиш со стрелками
2. Стены блокируют движение игрока
3. Собирайте монеты для очков
4. Достигните выхода, чтобы завершить уровень
5. Пройдите лабиринт как можно быстрее!

### Что Нам Нужно

| Элемент | Назначение |
|---------|------------|
| **Игрок** | Персонаж, которым вы управляете |
| **Стена** | Твёрдые препятствия, блокирующие движение |
| **Выход** | Цель, завершающая уровень |
| **Монета** | Собираемые предметы для очков |
| **Пол** | Визуальный фон (необязательно) |

---

## Шаг 2: Создать Спрайты

Все спрайты стен и пола должны быть 32x32 пикселя для создания правильной сетки.

### 2.1 Спрайт Игрока

1. В **Дереве Ресурсов** щёлкните правой кнопкой на **Спрайты** и выберите **Создать Спрайт**
2. Назовите его `spr_player`
3. Нажмите **Редактировать Спрайт**, чтобы открыть редактор
4. Нарисуйте маленького персонажа (круг, человека или форму стрелки)
5. Используйте яркий цвет, например синий или зелёный
6. Размер: 24x24 пикселя (меньше стен для более лёгкой навигации)
7. Нажмите **OK** для сохранения

### 2.2 Спрайт Стены

1. Создайте новый спрайт с именем `spr_wall`
2. Нарисуйте твёрдый узор кирпича или камня
3. Используйте серые или тёмные цвета
4. Размер: 32x32 пикселя

### 2.3 Спрайт Выхода

1. Создайте новый спрайт с именем `spr_exit`
2. Нарисуйте дверь, флаг или яркий маркер цели
3. Используйте зелёные или золотые цвета
4. Размер: 32x32 пикселя

### 2.4 Спрайт Монеты

1. Создайте новый спрайт с именем `spr_coin`
2. Нарисуйте маленький жёлтый/золотой круг
3. Размер: 16x16 пикселей

### 2.5 Спрайт Пола (Необязательно)

1. Создайте новый спрайт с именем `spr_floor`
2. Нарисуйте простой узор плитки пола
3. Используйте светлый нейтральный цвет
4. Размер: 32x32 пикселя

---

## Шаг 3: Создать Объект Стены

Стена блокирует движение игрока.

1. Щёлкните правой кнопкой на **Объекты** и выберите **Создать Объект**
2. Назовите его `obj_wall`
3. Установите спрайт на `spr_wall`
4. **Поставьте галочку "Твёрдый"**
5. События не нужны

---

## Шаг 4: Создать Объект Выхода

Выход завершает уровень, когда игрок его достигает.

1. Создайте новый объект с именем `obj_exit`
2. Установите спрайт на `spr_exit`

**Событие: Столкновение с obj_player**
1. Добавить Событие → Столкновение → obj_player
2. Добавить Действие: **Main2** → **Показать Сообщение**
   - Сообщение: `Вы победили! Время: ` + string(floor(global.timer)) + ` секунд`
3. Добавить Действие: **Main1** → **Следующая Комната** (или **Перезапустить Комнату** для одного уровня)

---

## Шаг 5: Создать Объект Монеты

Монеты добавляют к счёту при сборе.

1. Создайте новый объект с именем `obj_coin`
2. Установите спрайт на `spr_coin`

**Событие: Столкновение с obj_player**
1. Добавить Событие → Столкновение → obj_player
2. Добавить Действие: **Счёт** → **Установить Счёт**
   - Новый Счёт: `10`
   - Поставьте галочку "Относительно" для добавления 10 очков
3. Добавить Действие: **Main1** → **Уничтожить Экземпляр**
   - Применяется к: Self

---

## Шаг 6: Создать Объект Игрока

Игрок плавно двигается с помощью клавиш со стрелками.

1. Создайте новый объект с именем `obj_player`
2. Установите спрайт на `spr_player`

### 6.1 Событие Create - Инициализация Переменных

**Событие: Create**
1. Добавить Событие → Create
2. Добавить Действие: **Управление** → **Установить Переменную**
   - Переменная: `move_speed`
   - Значение: `4`

### 6.2 Движение со Столкновениями

**Событие: Step**
1. Добавить Событие → Step → Step
2. Добавить Действие: **Управление** → **Выполнить Код**

```gml
// Горизонтальное движение
var hspd = 0;
if (keyboard_check(vk_right)) hspd = move_speed;
if (keyboard_check(vk_left)) hspd = -move_speed;

// Вертикальное движение
var vspd = 0;
if (keyboard_check(vk_down)) vspd = move_speed;
if (keyboard_check(vk_up)) vspd = -move_speed;

// Проверка горизонтального столкновения
if (!place_meeting(x + hspd, y, obj_wall)) {
    x += hspd;
} else {
    // Двигаться как можно ближе к стене
    while (!place_meeting(x + sign(hspd), y, obj_wall)) {
        x += sign(hspd);
    }
}

// Проверка вертикального столкновения
if (!place_meeting(x, y + vspd, obj_wall)) {
    y += vspd;
} else {
    // Двигаться как можно ближе к стене
    while (!place_meeting(x, y + sign(vspd), obj_wall)) {
        y += sign(vspd);
    }
}
```

### 6.3 Альтернатива: Простое Движение Блоками

Если вы предпочитаете использовать блоки действий вместо кода:

**Событие: Клавиша Нажата - Стрелка Вправо**
1. Добавить Событие → Клавиатура → \<Вправо\>
2. Добавить Действие: **Управление** → **Проверить Столкновение**
   - Объект: `obj_wall`
   - X: `4`
   - Y: `0`
   - Проверить: NOT
3. Добавить Действие: **Движение** → **Прыгнуть на Позицию**
   - X: `4`
   - Y: `0`
   - Поставьте галочку "Относительно"

Повторите для Влево (-4, 0), Вверх (0, -4) и Вниз (0, 4).

---

## Шаг 7: Создать Контроллер Игры

Контроллер игры управляет таймером и отображает информацию.

1. Создайте новый объект с именем `obj_game_controller`
2. Спрайт не нужен

**Событие: Create**
1. Добавить Событие → Create
2. Добавить Действие: **Управление** → **Установить Переменную**
   - Переменная: `global.timer`
   - Значение: `0`

**Событие: Step**
1. Добавить Событие → Step → Step
2. Добавить Действие: **Управление** → **Установить Переменную**
   - Переменная: `global.timer`
   - Значение: `1/room_speed`
   - Поставьте галочку "Относительно"

**Событие: Draw**
1. Добавить Событие → Draw → Draw
2. Добавить Действие: **Управление** → **Выполнить Код**

```gml
// Нарисовать счёт
draw_set_color(c_white);
draw_text(10, 10, "Очки: " + string(score));

// Нарисовать таймер
draw_text(10, 30, "Время: " + string(floor(global.timer)) + "с");

// Нарисовать оставшиеся монеты
var coins_left = instance_number(obj_coin);
draw_text(10, 50, "Монеты: " + string(coins_left));
```

---

## Шаг 8: Спроектируйте Свой Лабиринт

1. Щёлкните правой кнопкой на **Комнаты** и выберите **Создать Комнату**
2. Назовите её `room_maze`
3. Установите размер комнаты (например, 640x480)
4. Включите "Привязка к Сетке" и установите сетку на 32x32

### Размещение Объектов

Постройте свой лабиринт по этим рекомендациям:

1. **Создайте границу** - Окружите комнату стенами
2. **Постройте коридоры** - Создайте пути через лабиринт
3. **Разместите выход** - Поставьте его в конце лабиринта
4. **Разбросайте монеты** - Разместите их вдоль путей
5. **Разместите игрока** - Рядом с входом
6. **Добавьте контроллер игры** - Где угодно (он невидим)

### Пример Макета Лабиринта

```
W W W W W W W W W W W W W W W W W W W W
W P . . . . W . . . . . . . W . . . . W
W . W W W . W . W W W W W . W . W W . W
W . W . . . . . . . . . . . . . . W . W
W . W . W W W W W . W W W W W W . W . W
W . . . W . . . . . . . . C . W . . . W
W W W . W . W W W W W W W . . W W W . W
W C . . . . W . . . . . W . . . . . . W
W . W W W W W . W W W . W W W W W W . W
W . . . . . . . . C . . . . . . . . . W
W . W W W W W W W W W . W W W W W W . W
W . . . . . . . . . . . W . . . . . . W
W W W W W W W W W W W . W . W W W W . W
W . . . . . . . . . . . . . W . C . E W
W W W W W W W W W W W W W W W W W W W W

W = Стена    P = Игрок    E = Выход    C = Монета    . = Пусто
```

---

## Шаг 9: Протестируйте Свою Игру!

1. Нажмите **Запустить** или нажмите **F5** для тестирования
2. Используйте клавиши со стрелками для навигации по лабиринту
3. Собирайте монеты для очков
4. Найдите выход, чтобы победить!

---

## Улучшения (Необязательно)

### Добавить Врагов

Создайте простого патрулирующего врага:

1. Создайте `spr_enemy` (красный цвет, 24x24)
2. Создайте `obj_enemy` со спрайтом `spr_enemy`

**Событие: Create**
```gml
hspeed = 2;  // Двигается горизонтально
```

**Событие: Столкновение с obj_wall**
```gml
hspeed = -hspeed;  // Изменить направление
```

**Событие: Столкновение с obj_player**
```gml
room_restart();  // Игрок проигрывает
```

### Добавить Систему Жизней

В событии Create `obj_game_controller`:
```gml
global.lives = 3;
```

Когда игрок касается врага (вместо перезапуска):
```gml
global.lives -= 1;
if (global.lives <= 0) {
    show_message("Игра окончена!");
    game_restart();
} else {
    // Возродить игрока на старте
    obj_player.x = start_x;
    obj_player.y = start_y;
}
```

### Добавить Ключи и Запертые Двери

1. Создайте `obj_key` - исчезает при сборе, устанавливает `global.has_key = true`
2. Создайте `obj_locked_door` - открывается только когда `global.has_key == true`

### Добавить Несколько Уровней

1. Создайте дополнительные комнаты (`room_maze2`, `room_maze3`)
2. В `obj_exit` используйте `room_goto_next()` вместо `room_restart()`

### Добавить Звуковые Эффекты

Добавьте звуки для:
- Сбора монет
- Достижения выхода
- Касания врагов (если добавлены)
- Фоновая музыка

---

## Устранение Неполадок

| Проблема | Решение |
|----------|---------|
| Игрок проходит сквозь стены | Проверьте, что `obj_wall` имеет отметку "Твёрдый" |
| Игрок застревает в стенах | Убедитесь, что спрайт игрока меньше промежутков между стенами |
| Монеты не исчезают | Проверьте, что событие столкновения уничтожает Self, а не Other |
| Таймер не работает | Убедитесь, что контроллер игры размещён в комнате |
| Движение кажется дёрганым | Настройте значение `move_speed` (попробуйте 3-5) |

---

## Что Вы Узнали

Поздравляем! Вы создали игру-лабиринт! Вы узнали:

- **Плавное движение** - Проверка состояния нажатых клавиш для непрерывного движения
- **Обнаружение столкновений** - Использование `place_meeting` для проверки перед движением
- **Пиксельно-точное столкновение** - Движение как можно ближе к стенам
- **Собираемые предметы** - Создание предметов, увеличивающих счёт и исчезающих
- **Система таймера** - Отслеживание времени с помощью переменных
- **Дизайн уровней** - Создание проходимых макетов лабиринтов

---

## Идеи для Вызовов

1. **Гонка со Временем** - Добавьте таймер обратного отсчёта. Достигните выхода до истечения времени!
2. **Идеальный Счёт** - Требуйте собрать все монеты перед открытием выхода
3. **Случайный Лабиринт** - Исследуйте процедурную генерацию лабиринтов
4. **Туман Войны** - Показывайте только область вокруг игрока
5. **Миникарта** - Отображайте маленький обзор лабиринта

---

## Смотрите Также

- [Руководства](Tutorials_ru) - Больше игровых руководств
- [Пресет для Начинающих](Beginner-Preset_ru) - Обзор функций для начинающих
- [Руководство: Pong](Tutorial-Pong_ru) - Создайте игру на двух игроков
- [Руководство: Breakout](Tutorial-Breakout_ru) - Создайте игру с разбиванием кирпичей
- [Руководство: Sokoban](Tutorial-Sokoban_ru) - Создайте головоломку с перемещением ящиков
- [Справочник Событий](Event-Reference_ru) - Полная документация событий
