# Windows EXE Export for PyGameMaker IDE

## Overview

The Windows EXE export feature allows you to package your PyGameMaker games as standalone Windows executables (.exe files) using PyInstaller. This creates a self-contained application that can run on any Windows computer without requiring Python or dependencies to be installed.

## Features

✅ **Standalone Executables** - Creates single-file or directory-based Windows executables
✅ **Asset Bundling** - Automatically includes all game assets (sprites, sounds, etc.)
✅ **Runtime Inclusion** - Bundles the PyGameMaker runtime engine
✅ **Progress Tracking** - Real-time progress dialog during export
✅ **Error Handling** - Graceful handling of missing dependencies
✅ **Customizable Settings** - Debug mode, optimization options
✅ **PyInstaller Integration** - Uses industry-standard packaging tool

## Prerequisites

### Required Software

1. **PyInstaller** - Python packaging tool
   ```bash
   pip install pyinstaller
   ```

2. **UPX** (Optional) - For executable compression/optimization
   - Download from: https://upx.github.io/
   - Add to system PATH for automatic use

### Verification

Check if PyInstaller is installed:
```bash
pyinstaller --version
```

## How to Export

### Via IDE Menu

1. Open your project in PyGameMaker IDE
2. Go to **File → Export Project...**
3. Select platform: **Desktop Executable (.exe/.app)**
4. Choose output directory
5. Click **Export**
6. Wait for build process (1-5 minutes depending on project size)
7. Find your .exe in the output directory

### Export Settings

The exporter uses these settings:

```python
export_settings = {
    'include_assets': True,   # Bundle all game assets
    'include_debug': False,   # No console window (windowed mode)
    'optimize': True          # Use UPX compression if available
}
```

## Build Process

The exporter performs these steps:

### 1. **PyInstaller Check** (10%)
- Verifies PyInstaller is installed
- Shows error with install instructions if missing

### 2. **Build Directory** (20%)
- Creates temporary build directory: `<project>/build_temp_exe/`
- Cleans any previous builds

### 3. **Copy Game Files** (30%)
- Copies `project.json`
- Copies `assets/` directory
- Copies PyGameMaker `runtime/` modules

### 4. **Generate Game Script** (40%)
- Creates `game_launcher.py` as entry point
- Configures pygame initialization
- Sets up game runner

### 5. **Create PyInstaller Spec** (50%)
- Generates `game.spec` file
- Configures data files and hidden imports
- Sets executable name and icon

### 6. **Build Executable** (60-90%)
- Runs PyInstaller (longest step)
- Bundles Python interpreter, dependencies, and game files
- Creates executable in `dist/` folder

### 7. **Copy to Output** (90%)
- Copies final .exe to chosen output directory
- Includes any required DLLs or data files

### 8. **Cleanup** (95-100%)
- Removes temporary build files (unless debug mode)
- Shows success message

## Output Structure

After successful export:

```
output_directory/
├── YourGame.exe          # Main executable
└── _internal/            # Required files (if not single-file mode)
    ├── runtime/
    ├── assets/
    └── project.json
```

## Generated Game Launcher

The exporter creates a standalone launcher script:

```python
#!/usr/bin/env python3
"""
Standalone Game Launcher for <GameName>
Generated by PyGameMaker IDE
"""

import pygame
import json
import sys
from pathlib import Path
from runtime.game_runner import GameRunner

def main():
    """Main game entry point"""
    try:
        pygame.init()

        # Load project file
        project_path = Path(__file__).parent / "project.json"

        if not project_path.exists():
            print(f"Error: Project file not found: {project_path}")
            sys.exit(1)

        # Create and run game
        runner = GameRunner()
        runner.run_game(str(project_path))

    except Exception as e:
        print(f"Game error: {e}")
        import traceback
        traceback.print_exc()
        sys.exit(1)
    finally:
        pygame.quit()

if __name__ == "__main__":
    main()
```

## PyInstaller Spec File

The exporter generates a spec file with these configurations:

```python
# game.spec
a = Analysis(
    ['game_launcher.py'],
    datas=[
        ("project.json", '.'),
        ('assets', 'assets'),
        ('runtime', 'runtime')
    ],
    hiddenimports=['pygame', 'json', 'pathlib', 'runtime.game_runner', 'runtime.action_executor'],
    # ... more configuration
)

exe = EXE(
    # ... bundled configuration
    name='GameName',
    debug=False,
    console=False,  # No console window
    upx=True,       # Compression enabled
    # ... more options
)
```

## Troubleshooting

### PyInstaller Not Found

**Error**: "PyInstaller not found. Please install it: pip install pyinstaller"

**Solution**:
```bash
pip install pyinstaller
```

### Build Timeout

**Error**: Build takes longer than 5 minutes

**Solution**:
- Reduce project size (remove unused assets)
- Disable UPX compression: `export_settings['optimize'] = False`
- Increase timeout in `exe_exporter.py` line 282

### Missing Runtime Modules

**Error**: "Runtime folder not found"

**Solution**:
- Ensure PyGameMaker IDE is properly installed
- Runtime should be at: `<IDE_ROOT>/runtime/`

### Large Executable Size

**Issue**: .exe file is very large (>100 MB)

**Solutions**:
1. Enable UPX compression: `export_settings['optimize'] = True`
2. Remove unused assets from project
3. Use directory mode instead of single-file mode

### Import Errors at Runtime

**Error**: Game crashes with "ModuleNotFoundError"

**Solution**:
- Add missing modules to `hiddenimports` in spec file (line 232)
- Example: `hiddenimports=['pygame', 'json', 'your_module']`

## Advanced Configuration

### Custom Icons

To add a custom icon:

1. Create a `.ico` file for your game
2. Edit `export/exe/exe_exporter.py` line 265:
   ```python
   icon='path/to/your/icon.ico',
   ```

### Debug Mode

To enable debug console:

```python
export_settings = {
    'include_debug': True,  # Shows console window
}
```

This displays:
- Print statements
- Error messages
- Debug information

### Single-File vs Directory Mode

Current implementation uses **single-file mode** (one .exe with embedded resources).

To use **directory mode** (faster startup):
Edit `exe_exporter.py` spec file generation around line 245.

## File Locations

```
PyGameMaker IDE/
├── export/
│   └── exe/
│       ├── __init__.py         # Package init
│       └── exe_exporter.py     # Main exporter class
├── dialogs/
│   └── project_dialogs.py      # Export dialog (_export_executable)
└── runtime/                    # Runtime bundled with exe
    ├── game_runner.py
    ├── action_executor.py
    └── game_engine.py
```

## API Reference

### ExeExporter Class

```python
from export.exe import ExeExporter

exporter = ExeExporter()

# Export project
success = exporter.export_project(
    project_path="/path/to/project.json",
    output_path="/path/to/output/dir",
    settings={
        'include_assets': True,
        'include_debug': False,
        'optimize': True
    }
)
```

### Signals

```python
# Progress updates (0-100, message)
exporter.progress_update.connect(lambda val, msg: print(f"{val}%: {msg}"))

# Export completion (success: bool, message: str)
exporter.export_complete.connect(lambda ok, msg: print(msg))
```

## Platform Support

| Platform | Support | Notes |
|----------|---------|-------|
| Windows  | ✅ Full | Primary target platform |
| Linux    | ⚠️ Partial | Creates Linux binaries (not .exe) |
| macOS    | ⚠️ Partial | Creates .app bundles (requires macOS) |

## Performance

| Project Size | Build Time | EXE Size |
|--------------|------------|----------|
| Small (< 10 assets) | 30-60s | 20-30 MB |
| Medium (10-50 assets) | 1-2 min | 30-50 MB |
| Large (50+ assets) | 2-5 min | 50-100+ MB |

## Security Notes

⚠️ **Antivirus False Positives**
- PyInstaller executables may trigger antivirus warnings
- This is a known issue with all PyInstaller apps
- Submit to virus databases for whitelisting if distributing publicly

⚠️ **Code Obfuscation**
- PyInstaller does NOT obfuscate code
- Python bytecode can be extracted from .exe
- Use additional tools (e.g., pyarmor) for code protection

## Examples

### Example 1: Simple Export

```python
from export.exe import ExeExporter

exporter = ExeExporter()
exporter.export_project(
    "C:/MyProjects/PlatformerGame/project.json",
    "C:/Exports/PlatformerGame",
    {'include_assets': True, 'include_debug': False, 'optimize': True}
)
```

### Example 2: Debug Build

```python
exporter = ExeExporter()
exporter.export_project(
    "/path/to/project.json",
    "/path/to/output",
    {'include_assets': True, 'include_debug': True, 'optimize': False}
)
```

## Changelog

### Version 1.0.0 (2025-11-14)
- ✅ Initial implementation
- ✅ PyInstaller integration
- ✅ Asset bundling
- ✅ Runtime inclusion
- ✅ Progress tracking
- ✅ Error handling
- ✅ UPX optimization support

## Support

For issues or questions:
1. Check this README
2. Review error messages in console
3. Verify PyInstaller installation
4. Check PyInstaller documentation: https://pyinstaller.org/

## License

Part of PyGameMaker IDE. Same license applies.
